<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¸¸ç®¡ç†ç³»ç»Ÿ - 34é‡‘å¸æ³•åˆ™</title>
    <link rel="stylesheet" href="libs/flatpickr.min.css">
    <link rel="stylesheet" href="libs/fullcalendar.min.css">
    <link rel="stylesheet" href="libs/choices.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="libs/particles.min.js"></script>
    <script src="libs/lunar.min.js"></script>
    <script src="libs/fullcalendar.min.js"></script>
    <script src="libs/flatpickr.min.js"></script>
    <script src="libs/flatpickr.zh.js"></script>
    <script src="libs/choices.min.js"></script>
    <script src="js/auth.js"></script>
    <script>
        checkLogin();
    </script>
</head>
<body>
    <!-- åŠ¨æ€ç²’å­èƒŒæ™¯ -->
    <div id="particles-js"></div>
    
    <div id="app">
        <header class="tech-header">
            <div class="header-bg"></div>
            <div class="header-container">
                <!-- å·¦ä¾§ï¼šç³»ç»Ÿåç§°å’Œæ ‡è¯­ -->
                <div class="header-left">
                    <h1><span class="icon">âš¡</span> æ—¥å¸¸ç®¡ç†ç³»ç»Ÿ</h1>
                    <p class="subtitle">34é‡‘å¸æ—¶é—´ç®¡ç†æ³•åˆ™ Â· è®©æ¯ä¸€å¤©éƒ½å……æ»¡ä»·å€¼</p>
                </div>
                
                <!-- ä¸­é—´ï¼šå¯¼èˆªèœå• -->
                <nav class="header-nav">
                    <button class="nav-btn active" data-page="ideas">
                        <span class="nav-icon">ğŸ’¡</span>
                        <span>çµæ„Ÿæ”¶é›†</span>
                    </button>
                    <button class="nav-btn" data-page="daily">
                        <span class="nav-icon">ğŸ“…</span>
                        <span>æ—¥å¸¸ç®¡ç†</span>
                    </button>
                    <button class="nav-btn" data-page="stats">
                        <span class="nav-icon">ğŸ“Š</span>
                        <span>æ•°æ®ç»Ÿè®¡</span>
                    </button>
                    <button class="nav-btn" data-page="manage" id="nav-manage">
                        <span class="nav-icon">ğŸ› ï¸</span>
                        <span>ç®¡ç†</span>
                    </button>
                </nav>
                
                <!-- å³ä¾§ï¼šç”¨æˆ·ä¿¡æ¯ä¸æœåŠ¡å¥åº· -->
                <div class="header-right" style="display: flex; align-items: center; gap: 15px;">
                    <div class="user-info" style="color: white; display: flex; align-items: center; gap: 10px;">
                        <span id="user-display-name"></span>
                        <button onclick="logout()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer;">é€€å‡º</button>
                    </div>
                    <div class="service-health">
                        <span class="health-icon">ğŸ©º</span>
                        <span id="api-status-indicator" class="health-status">æ£€æµ‹ä¸­</span>
                    </div>
                </div>
            </div>
        </header>
        
        <main>
            <!-- çµæ„Ÿæ”¶é›†é¡µé¢ -->
            <div id="page-ideas" class="page-content active">
                <div class="glass-card">
                    <div class="section-header">
                        <h2><span class="icon">ğŸ’¡</span> çµæ„Ÿæ”¶é›†ç«™</h2>
                        <select id="idea-sort" class="idea-sort-select">
                            <option value="time">æŒ‰æ—¶é—´æ’åº</option>
                            <option value="priority">æŒ‰ä¼˜å…ˆçº§æ’åº</option>
                        </select>
                    </div>
                    <div id="ideas-list" class="ideas-container"></div>
                    <div class="input-group">
                        <input type="text" id="new-idea" placeholder="ğŸ’­ è®°å½•ä½ çš„çµæ„Ÿå’Œæƒ³æ³•...">
                        <button id="add-idea" class="btn-primary">+ æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- æ—¥å¸¸ç®¡ç†é¡µé¢ -->
            <div id="page-daily" class="page-content">
                <div class="glass-card">
                    <div class="section-header">
                        <h2><span class="icon">ğŸ“…</span> æ—¥ç¨‹ç®¡ç†</h2>
                        <div id="calendar-legend" class="calendar-legend"></div>
                        <div class="section-actions">
                            <div class="urgency-filter-group">
                                <label class="filter-label" for="urgency-filter">ç´§æ€¥ç¨‹åº¦</label>
                                <select id="urgency-filter" class="urgency-filter-select">
                                    <option value="">å…¨éƒ¨ç´§æ€¥ç¨‹åº¦</option>
                                    <option value="ç´§æ€¥ä¸”é‡è¦">ç´§æ€¥ä¸”é‡è¦</option>
                                    <option value="ä¸ç´§æ€¥ä¸”é‡è¦">ä¸ç´§æ€¥ä¸”é‡è¦</option>
                                    <option value="ç´§æ€¥ä¸”ä¸é‡è¦">ç´§æ€¥ä¸”ä¸é‡è¦</option>
                                    <option value="ä¸ç´§æ€¥ä¸”ä¸é‡è¦">ä¸ç´§æ€¥ä¸”ä¸é‡è¦</option>
                                </select>
                                <button type="button" id="urgency-filter-clear" class="btn-tertiary">æ¸…ç©ºç­›é€‰</button>
                            </div>
                            <button id="add-event-button" class="btn-add-event">+ æ–°å»ºäº‹ä»¶</button>
                        </div>
                    </div>
                    <div id="calendar-view"></div>
                    <div id="calendar-score-bar" class="score-bar hidden"></div>
                </div>
            </div>
            
            <!-- æ•°æ®ç»Ÿè®¡é¡µé¢ -->
            <div id="page-stats" class="page-content">
                <div class="glass-card">
                    <div class="section-header">
                        <h2><span class="icon">ğŸ“Š</span> æ•°æ®ç»Ÿè®¡</h2>
                        <div class="stats-filters">
                            <select id="stats-year" class="stats-select">
                                <option value="">å…¨éƒ¨å¹´ä»½</option>
                            </select>
                            <select id="stats-month" class="stats-select">
                                <option value="">å…¨å¹´</option>
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                            <span class="badge" id="stats-update-time">åŠ è½½ä¸­...</span>
                        </div>
                    </div>
                    <div id="stats-container" class="stats-container">
                        <div class="stats-loading">æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...</div>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†ä¸­å¿ƒé¡µé¢ -->
            <div id="page-manage" class="page-content">
                <div class="glass-card">
                    <div class="section-header">
                        <h2><span class="icon">ğŸ› ï¸</span> ç®¡ç†ä¸­å¿ƒ</h2>
                        <span class="badge">äº‹ä»¶ç±»å‹</span>
                    </div>
                    <div class="manage-grid">
                        <section class="manage-section" id="admin-section" style="display:none;">
                            <h3>ç”¨æˆ·ç®¡ç†</h3>
                            <p class="manage-hint">ç®¡ç†ç³»ç»Ÿç”¨æˆ·å’Œæƒé™ã€‚</p>
                            <a href="admin.html" class="btn-primary manage-submit" style="text-decoration:none; display:inline-block; text-align:center;">è¿›å…¥ç”¨æˆ·ç®¡ç†</a>
                        </section>
                        <section class="manage-section">
                            <h3>å·²åˆ›å»ºç±»å‹</h3>
                            <p class="manage-hint">åœ¨è¿™é‡ŒæŸ¥çœ‹æˆ–åˆ é™¤äº‹ä»¶ç±»å‹ï¼Œä¿æŒåˆ†ç±»æ¸…æ™°ã€‚</p>
                            <div id="manage-type-list" class="manage-type-list"></div>
                        </section>
                        <section class="manage-section">
                            <h3>åˆ›å»ºæ–°ç±»å‹</h3>
                            <p class="manage-hint">è®¾ç½®ç±»å‹åç§°å’Œé¢œè‰²ï¼Œæ–¹ä¾¿åœ¨æ—¥å†ä¸­å¿«é€Ÿè¯†åˆ«ã€‚</p>
                            <form id="manage-type-form" class="manage-type-form">
                                <label class="modal-label" for="manage-type-name">ç±»å‹åç§°</label>
                                <input type="text" id="manage-type-name" placeholder="ä¾‹å¦‚ï¼šå­¦ä¹ ã€è¿åŠ¨ã€äº²å­æ—¶é—´">
                                <label class="modal-label" for="manage-type-color">ç±»å‹é¢œè‰²</label>
                                <div class="manage-color-row">
                                    <input type="color" id="manage-type-color" value="#667eea">
                                    <input type="text" id="manage-type-color-preview" class="manage-color-preview" value="#667eea" placeholder="#667eea" maxlength="7">
                                </div>
                                <button type="submit" class="btn-primary manage-submit">+ åˆ›å»ºç±»å‹</button>
                            </form>
                        </section>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="js/event-manager.js"></script>
    <script src="js/main.js"></script>
    <script src="js/calendar.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = getUser();
            if (user) {
                document.getElementById('user-display-name').textContent = user.username;
                
                if (user.is_admin) {
                    const adminSection = document.getElementById('admin-section');
                    if (adminSection) adminSection.style.display = 'block';
                } else {
                    // Hide Manage Tab for non-admins if required by "æ™®é€šç”¨æˆ·æ— æƒæŸ¥çœ‹ç®¡ç†"
                    // If "ç®¡ç†" means the whole tab:
                    const manageBtn = document.getElementById('nav-manage');
                    if (manageBtn) manageBtn.style.display = 'none';
                }
            }
        });
    </script>
</body>
</html>
